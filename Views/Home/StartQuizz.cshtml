@{
    Layout = null;
}
@model DoVuiHaiNao.Models.ViewModels.QuizSubmissionViewModel
<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trò chơi đố vui</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.4.0/dist/confetti.browser.min.js"></script>
    <style>
        body {
            text-align: center;
            background-color: rgb(43 43 110 / var(--tw-bg-opacity));
            color: white;
            --tw-bg-opacity: 1;

        }

        .container {
            max-width: 800px;
            margin-top: 50px;
        }

        #countdown {
            font-size: 120px;
            font-weight: bold;
            color: red;
            display: none;
        }

        .correct {
            color: lime;
            font-size: 36px;
        }

        .wrong {
            color: red;
            font-size: 36px;
        }

        button {
            font-size: 24px;
            padding: 15px 30px;
        }

        .answer-btn {
            display: block;
            width: 80%;
            margin: 10px auto;
            padding: 5px;
            font-size: 28px;
        }

        .btn-custom {
            font-size: 2em;
            padding: 5px 25px;
        }

        h1 {
            font-size: 4em;
        }

        .completion-text {
            font-size: 5em;
            font-weight: bold;
            color: red;
            text-align: center;
            margin-top: 20px;
        }
    </style>
</head>

<body>
    <div class="container-fluid mt-3">
        <div class="row justify-content-center d-flex">
            <div class="col-md-6">
                <a class="text-decoration-none text-light" asp-action="getQuizz" asp-route-id="@Model.QuizzId">Quay
                    lại</a>
            </div>
            <div class="Time col-md-6">05:30</div>
        </div>
    </div>
    <div class="container" style="margin-top: 10%;">

        <h1 id="title">Trò chơi đố vui</h1>
        <div id="startScreen">
            <button class="btn btn-primary btn-custom mt-5" onclick="startCountdown()">Bắt đầu</button>
        </div>
        <div id="countdown"></div>
        <div id="quizScreen" class="d-none">
            <p id="question" style="font-size: 3em;"></p>
            <div id="answers" class="mb-3"></div>
            <p id="feedback"></p>
            <button id="nextBtn" class="btn btn-success d-none" onclick="nextQuestion()">Tiếp (3s)</button>
        </div>
    </div>

    <script>
        const questions = [
            { q: "2 + 2 = ?", options: ["3", "4", "5"], answer: 1 },
            { q: "5 + 3 = ?", options: ["7", "8", "9"], answer: 1 }
        ];
        let currentQuestion = 0;
        let countdownElement = document.getElementById("countdown");
        let nextButton = document.getElementById("nextBtn");
        let nextTimer;
        let answered = false;

        function startCountdown() {
            document.getElementById("title").style.display = "none";
            document.getElementById("startScreen").classList.add("d-none");
            countdownElement.style.display = "block";
            let countdown = 3;
            countdownElement.innerText = countdown;
            let interval = setInterval(() => {
                countdown--;
                countdownElement.innerText = countdown;
                if (countdown === 0) {
                    clearInterval(interval);
                    countdownElement.style.display = "none";
                    startQuiz();
                }
            }, 1000);
        }

        function startQuiz() {
            document.getElementById("quizScreen").classList.remove("d-none");
            showQuestion();
        }

        function showQuestion() {
            answered = false;
            const questionData = questions[currentQuestion];
            document.getElementById("question").innerText = questionData.q;
            const answersDiv = document.getElementById("answers");
            answersDiv.innerHTML = "";
            document.getElementById("feedback").innerText = "";
            nextButton.classList.add("d-none");
            clearTimeout(nextTimer);

            questionData.options.forEach((opt, index) => {
                const btn = document.createElement("button");
                btn.classList.add("btn", "btn-outline-light", "answer-btn");
                btn.innerText = opt;
                btn.onclick = () => selectAnswer(index);
                answersDiv.appendChild(btn);
            });
        }

        function selectAnswer(selectedIndex) {
            if (answered) return;
            answered = true;
            const questionData = questions[currentQuestion];
            const feedback = document.getElementById("feedback");
            const buttons = document.querySelectorAll("#answers button");
            buttons.forEach(btn => btn.disabled = true);

            if (selectedIndex === questionData.answer) {
                feedback.innerHTML = "<span class='correct'>✔ Đúng! Bạn giỏi quá!</span>";
                confetti();
            } else {
                feedback.innerHTML = "<span class='wrong'>✖ Sai mất rồi!</span>";
            }
            startNextCountdown();
        }

        function startNextCountdown() {
            let timeLeft = 3;
            nextButton.innerText = `Tiếp (${timeLeft}s)`;
            nextButton.classList.remove("d-none");
            nextTimer = setInterval(() => {
                timeLeft--;
                nextButton.innerText = `Tiếp (${timeLeft}s)`;
                if (timeLeft === 0) {
                    clearInterval(nextTimer);
                    nextQuestion();
                }
            }, 1000);
        }

        function nextQuestion() {
            currentQuestion++;
            if (currentQuestion < questions.length) {
                showQuestion();
            } else {
                document.getElementById("quizScreen").innerHTML = "<h3 class='completion-text'>Hoàn thành!</h3>";
                confetti();
            }

        }
    </script>
</body>

</html>